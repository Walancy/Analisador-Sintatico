from automata.pda.npda import NPDA
from sys import argv

npda = NPDA(
    states={'qi','q0', 'q1', 'q2', 'q3', 'q4', 'q5', 'q6', 'q7', 'q8', 'q9', 'q10','q11','q12',
            'q13','q14','q15','q16', 'q17','q18','q19','q20','q21','q22','q23','q24','q25'},
            
    input_symbols={'(',')','*','+','-','/','=','d','i','m','n','u',''},
    stack_symbols={'(',')','*','+','-','/','=','d','i','m','n','u','$','E','F','S','T','V','$',''},

    transitions={

        'qi': {
            '': {
                '': {('q0', '$')}
            },  
        },

        'q0' : {
            'i': {
                '$':{('q7', ('i', '$'))}
            },
            'n':{
                '$':{('q8', ('n', '$'))}
            }, 
            '(':{
                '$':{('q1', ('(', '$'))}
            }, 
        },

        'q1': {
            '': {
                'i': {('q1', '')},       
                'V': {('q10', 'F')},      
                'F': {('q3',  'F')},     
            },
            '(':{
                '(':{('q1', ('(', '('))} 
            },
            'i': {
                '(':{('q7', ('i', '('))},
            },
            'n': {
                '(':{('q8', ('n', '('))},
            },
        },

        'q2': {
            '': {
                'E': {('q4', 'S')},        
            },
            '+': {
                'E': {('q11', ('+', 'E'))}, 
            },
            '-': {
                'E': {('q12', ('-', 'E'))},
            },
            '*': {
                'E': {('q13', ('*', 'E'))},
            },
            '/': {
                'E': {('q14', ('/', 'E'))}, 
            },
        }, 

        'q3': {
            '': {
                '$': {('q5',  ('T', '$'))}, 
                
                '+': {('q19', ('T', '+'))}, 
                
                '-': {('q20', ('T', '-'))}, 
                
                '*': {('q21', ('T', '*'))}, 
                
                '/': {('q22', ('T', '/'))}, 
                
                '=': {('q5',  ('T', '='))}, 
                '(': {('q5',  ('T', '('))}, 
                'F': {('q3', '')},          
            },
        },

        'q4': {
            '': {
                'S': {('q4', '')},          
                '$': {('q4', '')}           
            },
        },

        'q5': {
            '': {
                '$' : {('q2', ('E', '$'))}, 
                '=': {('q23', ('E', '='))}, 
                '(': {('q9',  ('E', '('))}, 
                'T': {('q5', '')},          
            },
            '*': {
                'T': {('q13', ('*', 'T'))}, 
            },
            '/': {
                'T': {('q14', ('/','T'))},  
            },
        },

        'q6': {
            '': {
                '$': {('q3',  ('F', '$'))}, 
                'V': {('q6', '')},          
            },
            '=': {
                'V': {('q15', ('=', 'V'))}, 
            },
        },

        'q7': {
            'd': {
                'i': {('q16', ('d', 'i'))}, 
            },   
        },

        'q8': {  
            'u': {
                'n': {('q17', ('u', 'n'))}, 
            },   
        },

        'q9': {
            '+' : {
                'E': {('q11', ('+', 'E'))}, 
            },
            '-' : {
                'E': {('q12', ('-', 'E'))}, 
            },
            ')': {
                'E': {('q18', (')', 'E'))}, 
            },   
        },

        'q10': {
            '': {
                'F': {('q3', '')},         
                'V': {('q3', 'F')},         
                '+': {('q3',  ('F', '+'))}, 
                '-': {('q3',  ('F', '-'))}, 
                '*': {('q21', ('F', '*'))}, 
                '/': {('q22', ('F', '/'))}, 
                '(': {('q3',  ('F', '('))}, 
            },    
        },

        'q11': {
            '': {
                'V': {('q3', 'F')},         
                'F': {('q3' , '')},        
                 
            },     
            'i': {
                '+': {('q7',  ('i', '+'))}, 
            },     
            'n': {
                '+': {('q8',  ('n', '+'))}, 
            },     
            '(': {
                '+': {('q1',  ('(', '+'))}, 
            },
        },

        'q12': {
            '' : {
                'V': {('q10',  '')},        
                'F': {('q3',   '',)},       
                'T': {('q20', 'T')},      
            },
            'i': {
                '-': {('q7',  ('i', '-'))}, 
            },
            'n': {
                '-': {('q8',  ('n', '-'))}, 
            },
            '(': {
                '-': {('q1',  ('(', '-'))}, 
            },
        },  

        'q13': {
            '' : {
                'V': {('q10',  '')},        
                'F': {('q21',  '')},      
            },
            'i': {
                '*': {('q7',  ('i', '*'))}, 
            },
            'n': {
                '*': {('q8',  ('n', '*'))}, 
            },
            '(': {
                '*': {('q1',  ('(', '*'))}, 
            },
        },

        'q14': {
            '' : {
                'V': {('q10',  '')},      
                'F': {('q22', 'F')},        
            },
            'i': {
                '/': {('q7',  ('i', '/'))}, 
            },
            'n': {
                '/': {('q8',  ('n', '/'))}, 
            },
            '(': {
                '/': {('q1',  ('(', '/'))}, 
            },
        },

        'q15': {
            '' : {
                'T': {('q3',  'T')},      
            },
            'i': {
                '=': {('q7',  ('i', '='))}, 
            }, 
            'n': {
                '=': {('q8',  ('n', '='))},
            }, 
            '(': {
                '=': {('q1',  ('(', '='))}, 
            }, 
        },

        'q16':{
            '': {
                '$': {('q6',  ('V', '$'))}, 
                '=': {('q10', ('V', '='))}, 
                '(': {('q10', ('V', '('))}, 
                '+': {('q11', ('V', '+'))}, 
                '-': {('q12', ('V', '-'))},
                '*': {('q10', ('V', '*'))}, 
                '/': {('q10', ('V', '/'))}, 
                'd': {('q16',  '')},        
                'i': {('q16',  '')},       
            },  
        },

        'q17':{
            'm': {
                'u': {('q24', ('m', 'u'))}, 
            }
        },
        'q18':{
            '': {
                '=': {('q3',  ('F', '='))}, 
                '$': {('q3',  ('F', '$'))}, 
                '+': {('q3',  ('F', '+'))},
                '-': {('q3',  ('F', '-'))}, 
                '*': {('q3',  ('F', '*'))},
                '/': {('q3',  ('F', '/'))},
                ')': {('q18',  '')},               
                'E': {('q18',  '')},        
                '(': {('q3',  'F')},         
            },
 
        },

        'q19':{
            '': {
                '$': {('q2',  ('E', '$'))}, 
                '(': {('q9', ('E', '('))}, 
                '=': {('q23', ('E', '='))},
                '+': {('q19',  '')},     
                'E': {('q19',  '')},      
                'T': {('q19',  '')},      
            },
            '*': {
                'T': {('q13', ('*', 'T'))}, 
            },
            '/': {
                'T': {('q14', ('/', 'T'))}, 
            }
        },

        'q20':{
            '': {
                '$': {('q2',  ('E', '$'))}, 
                '(': {('q9', ('E', '('))}, 
                '=': {('q23', ('E', '='))}, 
                'E': {('q20',  '')},        
                '-': {('q20',  '')},       
                'T': {('q20',  '')},        
            },
            '*': {
                'T': {('q13', ('*', 'T'))},
            },
            '/': {
                'T': {('q14', ('/', 'T'))},
            }

        },

        'q21':{
            '': {
                '$': {('q5',  ('T', '$'))}, 
                '(': {('q5',  ('T', '('))}, 
                '=': {('q5',  ('T', '='))}, 
                '+': {('q19',  ('T', '+'))}, 
                '-': {('q20',  ('T', '-'))}, 
                '*': {('q21',  '')},        
                'F': {('q21',  '')},       
                'T': {('q21',  '')},       
            },
        },

        'q22':{
            '': {
                '$': {('q5',  ('T', '$'))},
                '(': {('q5',  ('T', '('))},
                '=': {('q5',  ('T', '='))}, 
                '+': {('q19',  ('T', '+'))}, 
                '-': {('q20',  ('T', '-'))},
                '/': {('q22',  '')},        
                'F': {('q22',  '')},       
                'T': {('q22',  '')},        
            }
        },

        'q23':{
            '': {
                '$': {('q4',  ('S', '$'))},
                '=': {('q23',  '')},        
                'E': {('q23',  '')},       
                'V': {('q23',  '')},       
            },
            '+': {
                'E': {('q11', ('+', 'E'))},
            },
            '-': {
                'E': {('q12', ('-', 'E'))}, 
            }
        },

        'q24':{
            '': {
                '$': {('q3',  ('F', '$'))}, 
                '=': {('q3',  ('F', '='))},
                '(': {('q3',  ('F', '('))}, 
                '+': {('q11', ('F', '+'))},
                '-': {('q12', ('F', '-'))}, 
                '*': {('q13', ('F', '*'))}, 
                '/': {('q14', ('F', '/'))}, 
                'm': {('q24',  '')},        
                'u': {('q24',  '')},       
                'n': {('q24',  '')},        
            },
        },

    },

    initial_state ='qi',         
    initial_stack_symbol ='',          
    final_states = {'q2', 'q3', 'q4', 'q5', 'q6', 'q10', 'q16', 'q18', 'q19', 'q20', 'q21', 'q22', 'q23', 'q24'},
    acceptance_mode = 'empty_stack'   
)

if __name__ == "__main__":
    if len(argv) < 2 :
        raise IOError("Use "+ argv[0] + " file.exp")
    else :
        aux = argv[1].split('.')
        if aux[-1] != 'exp':
            raise IOError("Not a .exp file!")
        data = open(argv[1])

        source_file = data.read()
    
    print('Testing:', source_file)

    if npda.accepts_input(source_file):
        print('[ Accepted ]')
    else:
        print('[ Rejected ]')